<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f4;
        }

        header {
            background-color: #2f3841;
            color: white;
            padding: 10px 0;
            width: 100%;
            text-align: center;
        }

        .search-container {
            margin: 20px 0;
        }

        .search-container input[type="text"],
        .search-container input[type="number"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
        }

        .search-container button {
            padding: 10px 20px;
            border: none;
            background-color: #2f3841;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        .search-container button:hover {
            background-color: white;
            color: #2f3841;
        }

        .search-container button:active {
            background-color: #2f3841;
            color: white;
        }

        .results-container {
            width: 80%;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table,
        th,
        td {
            border: 1px solid #ccc;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #2f3841;
            color: white;
        }

        .loading-message {
            display: none;
            color: #2f3841;
            font-size: 16px;
            margin-top: 10px;
            text-align: center;
        }
    </style>
    </head>

<body>
    <header>
        <h1>PR Search</h1>
        </header>

    <div class="search-container">
        <input type="text" id="owner-input" placeholder="Enter owner">
        <input type="text" id="repo-input" placeholder="Enter repo">
        <button onclick="getVersions()">Get Versions</button>
        <select id="base-version">
            <!-- Options will be populated dynamically -->
        </select>
        <select id="compare-version">
            <!-- Options will be populated dynamically -->
        </select>
        <input type="text" id="search-input" placeholder="Enter your search query">
        <input type="number" id="top-n-input" placeholder="Enter number of results">
        <button onclick="performSearch()">Search</button>
        </div>

    <div class="results-container">
        <!-- <div id="loading-message" class="loading-message">Loading</div> -->
        <table id="results-table">
            <thead>
                <tr>
                    <th>Index</th>
                    <th>Number</th>
                    <th>Title</th>
                </tr>
                </thead>
            <!-- <div id="loading-message" class="loading-message">Loading...</div> -->
            <tbody id="results-body">
                    <!-- Results will be inserted here -->
                    <tr id="loading-message" class="loading-message">
                        <td colspan="3">Loading...</td>
            </tbody>
            </table>
        <!-- <div id="loading-message" class="loading-message">Loading...</div> -->
    </div>

    <script>
        async function fetchVersions(owner, repo) {
            const response = await fetch('/api/versions/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ owner, repo })
            });
            const versions = await response.json();
            return versions;
        }

            function populateDropdown(dropdown, versions) {
                dropdown.innerHTML = '';
                Object.values(versions).forEach(version => {
                    const option = document.createElement('option');
                    option.value = version;
                    option.textContent = version;
                    dropdown.appendChild(option);
                });
            }

            async function getVersions() {
                const owner = document.getElementById('owner-input').value;
                const repo = document.getElementById('repo-input').value;
                const versions = await fetchVersions(owner, repo);
                const baseVersionDropdown = document.getElementById('base-version');
                const compareVersionDropdown = document.getElementById('compare-version');

                populateDropdown(baseVersionDropdown, versions);
                populateDropdown(compareVersionDropdown, versions);
            }
                            function clearResults() {
                                const resultsBody = document.getElementById('results-body');
                                while (resultsBody.firstChild) {
                                    resultsBody.removeChild(resultsBody.firstChild);
                                }
                            }


            function performSearch() {
                // resultsBody.innerHTML = ''; // Clear previous results
                const loadingMessage = document.getElementById('loading-message');
                const resultsBody = document.getElementById('results-body');
                loadingMessage.style.display = 'table-row';

                const query = document.getElementById('search-input').value;
                const baseVersion = document.getElementById('base-version').value;
                const compareVersion = document.getElementById('compare-version').value;
                const owner = document.getElementById('owner-input').value;
                const repo = document.getElementById('repo-input').value;
                const n = document.getElementById('top-n-input').value;

                fetch('/api/search/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query, baseVersion, compareVersion, owner, repo, n })
                })
                    .then(response => response.json())
                    .then(data => {
                        // resultsBody.innerHTML = ''; // Clear previous results
                        // clearResults();
                        const resultsBody = document.getElementById('results-body');
                        data.forEach((result, index) => {
                            const row = resultsBody.insertRow();
                            const cellIndex = row.insertCell(0);
                            const cellNumber = row.insertCell(1);
                            const cellTitle = row.insertCell(2);

                            cellIndex.textContent = index + 1;
                            cellTitle.textContent = result.title;

                            const link = document.createElement('a');
                            link.href = result.link;
                            link.textContent = result.number;
                            cellNumber.appendChild(link);
                        });

                        loadingMessage.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        loadingMessage.style.display = 'none';
                    });
            }
</script>
    </body>

</html>
